<div
  class="task-card"
  [class.overdue]="isOverdue()"
  [class.done]="isDone()"
  (click)="handleTaskClick()"
>
  <div class="task-header">
    <h4 class="task-title" [class.done]="isDone()">
      {{ task.title }}
    </h4>
    <div class="task-actions">
      <button class="edit-btn" (click)="onEdit(); $event.stopPropagation()" title="Edit task">
        ✏️
      </button>
      <button
        class="delete-btn"
        [class.warning]="isDeleteModalOpen"
        (click)="openDeleteModal(); $event.stopPropagation()"
        title="Delete task"
      >
        🗑️
      </button>
    </div>
  </div>

  @if (task.description) {
  <p class="task-description" [class.done]="isDone()">{{ task.description }}</p>
  }

  <div class="task-footer" [class.done]="isDone()">
    <div class="task-priority" [ngClass]="getPriorityClass()">
      <span class="priority-icon">{{ getPriorityIcon() }}</span>
      <span class="priority-text">{{ task.priority | titlecase }}</span>
    </div>

    @if (task.dueDate) {
    <div class="task-due-date" [class.overdue]="isOverdue()">
      Due: {{ formatDate(task.dueDate) }}
    </div>
    }
  </div>

  <div class="drag-handle" title="Drag to move">⋮⋮</div>
</div>

@if (isDeleteModalOpen) {
<app-modal
  #deleteTaskModal
  id="delete-task-modal"
  [isOpen]="true"
  [isWarning]="true"
  [isLoading]="deleteIsLoading"
  [modalTitle]="'Delete Task'"
  [confirmText]="'Delete'"
  [cancelText]="'Cancel'"
  [fitToContent]="true"
  [confirmDisabled]="deleteModalInput.toLowerCase() !== 'delete'"
  (onConfirm)="onDeleteModalConfirm()"
  (onCancel)="onDeleteModalCancel()"
  [autoCloseOnConfirm]="true"
>
  <div class="delete-modal-text">
    <h3>Are you sure you want to delete this task?</h3>
    <h4>Confirm by typing "delete" in the input below.</h4>
  </div>

  <div class="delete-modal-input-container">
    <input
      id="delete-modal-input"
      type="text"
      class="delete-modal-input"
      [value]="deleteModalInput"
      placeholder="Type 'delete' to confirm"
      (input)="onDeleteModalInputChange($event)"
    />
  </div>
</app-modal>
}
